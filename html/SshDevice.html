<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=IBM437" http-equiv="Content-Type">

<title>module SshDevice - BrocadeSAN</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="module">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/brocadesan/device.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    
    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-new">::new</a>
    
    <li><a href="#method-i-get_mode">#get_mode</a>
    
    <li><a href="#method-i-query">#query</a>
    
    <li><a href="#method-i-session">#session</a>
    
    <li><a href="#method-i-set_mode">#set_mode</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./README.html">README</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./Brocade.html">Brocade</a>
  
    <li><a href="./Brocade/SAN.html">Brocade::SAN</a>
  
    <li><a href="./Brocade/SAN/Alias.html">Brocade::SAN::Alias</a>
  
    <li><a href="./Brocade/SAN/Provisioning.html">Brocade::SAN::Provisioning</a>
  
    <li><a href="./Brocade/SAN/Provisioning/Agent.html">Brocade::SAN::Provisioning::Agent</a>
  
    <li><a href="./Brocade/SAN/Provisioning/Agent/Error.html">Brocade::SAN::Provisioning::Agent::Error</a>
  
    <li><a href="./Brocade/SAN/Switch.html">Brocade::SAN::Switch</a>
  
    <li><a href="./Brocade/SAN/Switch/Error.html">Brocade::SAN::Switch::Error</a>
  
    <li><a href="./Brocade/SAN/Switch/Response.html">Brocade::SAN::Switch::Response</a>
  
    <li><a href="./Brocade/SAN/Wwn.html">Brocade::SAN::Wwn</a>
  
    <li><a href="./Brocade/SAN/Zone.html">Brocade::SAN::Zone</a>
  
    <li><a href="./Brocade/SAN/ZoneConfiguration.html">Brocade::SAN::ZoneConfiguration</a>
  
    <li><a href="./SshDevice.html">SshDevice</a>
  
    <li><a href="./SshDevice/Error.html">SshDevice::Error</a>
  
    <li><a href="./SshDevice/Response.html">SshDevice::Response</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="module">module SshDevice</h1>

  <div id="description" class="description">
    
<p>Basic wrapper class that runs SSH queries on the device and returns <a
href="SshDevice/Response.html">Response</a></p>

<p>It is used to extend further classes with SSH query mechanism</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="DEFAULT_QUERY_PROMPT">DEFAULT_QUERY_PROMPT
        
        <dd class="description"><p>default query prompt that will preceed each command started by
<code>query</code> in the <a href="SshDevice/Response.html">Response</a>
<code>data</code></p>

<p>value is "&gt; "</p>

<p>This way the parser can separate from commands and data. The default will
work everwhere where the retunned data is not prepended by "&gt; "</p>

<p>Ignore the ssh prompt like this: super_server(admin)&gt; cmd
super_server(admin)&gt; data</p>

<p>This on the other hand would be problem. In this case override the prompt
super_server(admin)&gt; cmd super_server(admin)&gt;&gt; data</p>
        
      
      </dl>
    </section>
    

    
    <!-- Attributes -->
    <section id="attribute-method-details" class="method-section section">
      <h3 class="section-header">Attributes</h3>

      
      <div id="attribute-i-prompt" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">prompt</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section><!-- attribute-method-details -->
    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(address,user,password,opts={})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Initialization method</p>

<p><code>opts</code> can be:</p>
<dl class="rdoc-list label-list"><dt>:interactive
<dd>
<p><code>true</code> / <code>false</code> will use interactive query can be
set later</p>
</dd><dt>:prompt
<dd>
<p><code>prompt</code> will override the <a
href="SshDevice.html#DEFAULT_QUERY_PROMPT">DEFAULT_QUERY_PROMPT</a></p>
</dd></dl>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/brocadesan/device.rb, line 36</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">address</span>,<span class="ruby-identifier">user</span>,<span class="ruby-identifier">password</span>,<span class="ruby-identifier">opts</span>={}) 
    <span class="ruby-ivar">@address</span>=<span class="ruby-identifier">address</span>
    <span class="ruby-ivar">@user</span>=<span class="ruby-identifier">user</span>
    <span class="ruby-ivar">@password</span>=<span class="ruby-identifier">password</span>
    <span class="ruby-ivar">@opts</span>=<span class="ruby-identifier">opts</span>
    <span class="ruby-ivar">@session</span>=<span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@session_level</span>=<span class="ruby-value">0</span>
    <span class="ruby-ivar">@prompt</span> = <span class="ruby-identifier">opts</span>[<span class="ruby-value">:prompt</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">opts</span>[<span class="ruby-value">:prompt</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">:</span> <span class="ruby-constant">DEFAULT_QUERY_PROMPT</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-get_mode" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_mode</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>get current query mode</p>

<p>returns either <code>interactive</code> or <code>script</code></p>

<p>default mode is <code>script</code></p>
          

          
          <div class="method-source-code" id="get_mode-source">
            <pre><span class="ruby-comment"># File lib/brocadesan/device.rb, line 51</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_mode</span>
  [<span class="ruby-keyword">true</span>,<span class="ruby-keyword">false</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-ivar">@opts</span>[<span class="ruby-value">:interactive</span>]) <span class="ruby-operator">?</span> (<span class="ruby-ivar">@opts</span>[<span class="ruby-value">:interactive</span>]<span class="ruby-operator">==</span><span class="ruby-keyword">true</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;interactive&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;script&quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-string">&quot;script&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_mode-source -->
          
        </div>

        

        
      </div><!-- get_mode-method -->

    
      <div id="method-i-query" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">query</span><span
            class="method-args">(*cmds)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Queries <code>cmds</code> commands directly.  This method is to be used to
implement higlevel API  or  to do more difficult queries that have to be
parsed separately and for which there is now highlevel API</p>

<p>When started in interactive mode be sure the command is followed by inputs
for that command. If command will require additional input and there is not
one provided the prompt will receive <code>enter</code>. It will do this
maximum of 100 times, then it gives up and returns whatever it got until
then.</p>

<p>Query command will open connection to device if called outside session
block or use existing session if called within session block.</p>

<p>Example:</p>

<pre class="ruby"><span class="ruby-operator">&gt;&gt;</span> <span class="ruby-keyword">class</span> <span class="ruby-constant">Test</span>
<span class="ruby-operator">&gt;&gt;</span>   <span class="ruby-identifier">include</span> <span class="ruby-constant">SshDevice</span>
<span class="ruby-operator">&gt;&gt;</span> <span class="ruby-keyword">end</span>
<span class="ruby-operator">&gt;&gt;</span> <span class="ruby-identifier">device</span> = <span class="ruby-constant">Test</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;address&quot;</span>,<span class="ruby-string">&quot;user&quot;</span>,<span class="ruby-string">&quot;password&quot;</span>)
<span class="ruby-operator">&gt;&gt;</span> <span class="ruby-identifier">device</span>.<span class="ruby-identifier">query</span>(<span class="ruby-string">&quot;switchname&quot;</span>)
=<span class="ruby-operator">&gt;</span> <span class="ruby-comment">#&lt;Test::Response:0x2bb1e00 @errors=&quot;&quot;, @data=&quot;&gt; switchname\nsanswitchA\n&quot;, @parsed={:parsing_position=&gt;&quot;end&quot;}&gt;</span>
</pre>

<p>Returns instance of <a href="SshDevice/Response.html">Response</a> or
raises <a href="SshDevice/Error.html">Error</a> if the connection cannot be
opened</p>

<p>Raises <a href="SshDevice/Error.html">Error</a> if SSH returns error. SSH
error will be available in the exception message</p>
          

          
          <div class="method-source-code" id="query-source">
            <pre><span class="ruby-comment"># File lib/brocadesan/device.rb, line 89</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">query</span>(*<span class="ruby-identifier">cmds</span>)
  <span class="ruby-identifier">output</span>=<span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">session_exist?</span>
    <span class="ruby-identifier">output</span>=<span class="ruby-identifier">exec</span>(<span class="ruby-ivar">@session</span>,<span class="ruby-identifier">cmds</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span>.<span class="ruby-identifier">start</span> <span class="ruby-ivar">@address</span>, <span class="ruby-ivar">@user</span>, <span class="ruby-value">:password=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@password</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ssh</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">output</span>=<span class="ruby-identifier">exec</span>(<span class="ruby-identifier">ssh</span>,<span class="ruby-identifier">cmds</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">raise</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">output</span>.<span class="ruby-identifier">errors</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">output</span>.<span class="ruby-identifier">errors</span>.<span class="ruby-identifier">empty?</span>
  
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">output</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- query-source -->
          
        </div>

        

        
      </div><!-- query-method -->

    
      <div id="method-i-session" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">session</span><span
            class="method-args">() { || ... }</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Opens a session block</p>

<p>All queries within the session block use the same connection. This speeds
up the query processing.</p>

<p>The connection is closed at the end of the block</p>

<p>The command supports session blocks within session blocks. Session will be
closed only at the last block</p>

<p>Example:</p>

<pre>device.session do 
  device.query(&quot;switchname&quot;)
  device.version
end</pre>

<p>Raises <a href="SshDevice/Error.html">SshDevice::Error</a> if run without
block</p>
          

          
          <div class="method-source-code" id="session-source">
            <pre><span class="ruby-comment"># File lib/brocadesan/device.rb, line 119</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">session</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span><span class="ruby-operator">::</span><span class="ruby-constant">Error</span><span class="ruby-operator">::</span><span class="ruby-constant">SESSION_WTIHOUT_BLOCK</span>) <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">block_given?</span>
  <span class="ruby-ivar">@session_level</span><span class="ruby-operator">+=</span><span class="ruby-value">1</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">session_exist?</span>
    <span class="ruby-ivar">@session</span>=<span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span>.<span class="ruby-identifier">start</span> <span class="ruby-ivar">@address</span>, <span class="ruby-ivar">@user</span>, <span class="ruby-value">:password=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@password</span>
  <span class="ruby-keyword">end</span> 
  <span class="ruby-keyword">yield</span>
  
<span class="ruby-keyword">ensure</span>
  <span class="ruby-ivar">@session_level</span><span class="ruby-operator">-=</span><span class="ruby-value">1</span>
  <span class="ruby-ivar">@session</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@session</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@session_level</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- session-source -->
          
        </div>

        

        
      </div><!-- session-method -->

    
      <div id="method-i-set_mode" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_mode</span><span
            class="method-args">(mode)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>sets current query mode</p>

<p><code>mode</code>: interactive or script</p>

<p>interactive - used to do interactive queries in scripted manner by
providing all responses in advance, see <a
href="SshDevice.html#method-i-query">query</a></p>
          

          
          <div class="method-source-code" id="set_mode-source">
            <pre><span class="ruby-comment"># File lib/brocadesan/device.rb, line 60</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_mode</span>(<span class="ruby-identifier">mode</span>)
  <span class="ruby-ivar">@opts</span>[<span class="ruby-value">:interactive</span>] = <span class="ruby-identifier">mode</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;interactive&quot;</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">get_mode</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_mode-source -->
          
        </div>

        

        
      </div><!-- set_mode-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

